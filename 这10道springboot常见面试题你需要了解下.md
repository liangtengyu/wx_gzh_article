### è·¨åŸŸæ˜¯ä»€ä¹ˆæ„æ€???

![img](https://mmbiz.qpic.cn/mmbiz_png/vwiav2ugSZtvAQbCCibLiaYVDS4zDwicpfgP6MBricF9MnfBA1hyMAdGGOia5t3eccU2qiazd3yQtBaIl2vPPf0Olgt1w/640?wx_fmt=jpeg)
åšå¼€å‘çš„å°ä¼™ä¼´å¤šå°‘ä¼šçœ‹è¿‡è¿™ä¸ªå›¾å§  ä¸‹é¢æˆ‘ä»¬å°±æ¥è¯´è¯´è·¨åŸŸæ˜¯ä»€ä¹ˆ

è¦äº†è§£è·¨åŸŸé¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä¸€äº›å‰ç½®çŸ¥è¯†:

â€‹			ä¸€ä¸ªURLæ˜¯æ€ä¹ˆç»„æˆçš„ï¼š

> // åè®® + åŸŸåï¼ˆå­åŸŸå + ä¸»åŸŸåï¼‰ + ç«¯å£å· + èµ„æºåœ°å€
> http://www.baidu.com:8080/

åªè¦**åè®®ï¼Œå­åŸŸåï¼Œä¸»åŸŸåï¼Œç«¯å£å·**è¿™å››é¡¹ç»„æˆéƒ¨åˆ†ä¸­æœ‰ä¸€é¡¹ä¸åŒ
å°±å¯ä»¥è®¤ä¸ºæ˜¯ä¸åŒçš„åŸŸï¼Œä¸åŒçš„åŸŸä¹‹é—´äº’ç›¸è®¿é—®èµ„æºï¼Œå°±è¢«ç§°ä¹‹ä¸ºè·¨åŸŸã€‚

éšç€å‰åç«¯åˆ†ç¦»å¼€å‘çš„è¶Šæ¥è¶Šæ™®åŠï¼Œä¼šç»å¸¸é‡åˆ°è·¨åŸŸçš„é—®é¢˜ï¼Œå½“æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­çœ‹åˆ°è¿™æ ·çš„é”™è¯¯æ—¶ï¼Œå°±éœ€è¦æ„è¯†åˆ°é‡åˆ°äº†è·¨åŸŸï¼š



### å¦‚ä½•è§£å†³è·¨åŸŸé—®é¢˜å‘¢?

é¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨`vue-cli`æ¥å¿«é€Ÿæ„å»ºä¸€ä¸ªå‰ç«¯é¡¹ç›®ï¼Œç„¶åä½¿ç”¨`axios`æ¥å‘åå°å‘é€ajaxè¯·æ±‚ã€‚æœ€ååœ¨æ§åˆ¶å°ä¸­æ‰“å°å‡ºè¿”å›ä¿¡æ¯ã€‚è¿™é‡Œå°±ä¸å†å¤šåšèµ˜è¿°ï¼Œåé¢æˆ‘ä¼šå•ç‹¬å†™ä¸€ç¯‡æ–‡ç« æ¥è®²ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨vue-cliå¿«é€Ÿåˆ›å»ºä¸€ä¸ªvueé¡¹ç›®ã€‚

> è¿™é‡Œä¸å†è®²è§£ä½¿ç”¨`jsonp`çš„æ–¹å¼æ¥è§£å†³è·¨åŸŸï¼Œå› ä¸º`jsonp`æ–¹å¼åªèƒ½é€šè¿‡`get`è¯·æ±‚æ–¹å¼æ¥ä¼ é€’å‚æ•°ï¼Œè€Œä¸”æœ‰ä¸€äº›ä¸ä¾¿ä¹‹å¤„ã€‚

ä¸‹é¢çš„å‡ ç§æ–¹å¼éƒ½æ˜¯é€šè¿‡**è·¨åŸŸè®¿é—®æŠ€æœ¯CORS(Cross-Origin Resource Sharingï¼‰**æ¥è§£å†³çš„ã€‚å…·ä½“çš„å®ç°åŸç†æˆ‘ä»¬ä¸åšæ·±å…¥çš„æ¢ç©¶ï¼Œè¿™èŠ‚è¯¾çš„ç›®çš„æ˜¯è§£å†³è·¨åŸŸé—®é¢˜~

#### æ–¹æ³•ä¸€ï¼šæ³¨è§£æ–¹å¼

åœ¨Spring Boot ä¸­ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ³¨è§£`@CrossOrigin`æ¥å®ç°è·¨åŸŸï¼Œè¿™ä¸ªæ³¨è§£å¯ä»¥å®ç°æ–¹æ³•çº§åˆ«çš„ç»†ç²’åº¦çš„è·¨åŸŸæ§åˆ¶ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ç±»æˆ–è€…æ–¹æ·»åŠ è¯¥æ³¨è§£ï¼Œå¦‚æœåœ¨ç±»ä¸Šæ·»åŠ è¯¥æ³¨è§£ï¼Œè¯¥ç±»ä¸‹çš„æ‰€æœ‰æ¥å£éƒ½å¯ä»¥é€šè¿‡è·¨åŸŸè®¿é—®ï¼Œå¦‚æœåœ¨æ–¹æ³•ä¸Šæ·»åŠ æ³¨è§£ï¼Œé‚£ä¹ˆä»…ä»…åªé™äºåŠ æ³¨è§£çš„æ–¹æ³•å¯ä»¥è®¿é—® å¦‚ä¸‹ä»£ç  æˆ‘ä»¬åœ¨ç±»åä¸ŠåŠ ä¸Šä¸€ä¸ªæ³¨è§£`@CrossOrigin`æ¥å®ç°è·¨åŸŸã€‚

```
@RestController
@RequestMapping("/user")
@CrossOrigin
public class UserController {
   @Autowired
    private UserService userService;

   @RequestMapping("/findAll")
    public Object findAll(){
        return userService.list();
    }
}
```

ç°åœ¨å†å»æµ‹è¯•ä¸€ä¸‹ï¼š

![img](https://mmbiz.qpic.cn/mmbiz_png/vwiav2ugSZtvAQbCCibLiaYVDS4zDwicpfgPqMEjXNRgUHkGnia6iaDODlaiacbiaOicicaAs65WjialIlyicbQPxXYmFWut7w/640?wx_fmt=jpeg)

æµ‹è¯•ç»“æœä¸ºæˆåŠŸï¼

#### æ–¹æ³•äºŒï¼šé€šè¿‡å®ç°WebMvcConfigurerç±»

è¿™é‡Œå¯ä»¥é€šè¿‡å®ç°`WebMvcConfigurer`æ¥å£ä¸­çš„`addCorsMappings()`æ–¹æ³•æ¥å®ç°è·¨åŸŸã€‚

```
@Configuration
class CORSConfiguration implements WebMvcConfigurer {
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/**");
    }
}
```

ä¸‹é¢æˆ‘ä»¬å°†åˆšåˆšåŠ ä¸Šçš„æ³¨è§£ç»™æ³¨é‡Šæ‰ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½è®¿é—®åˆ°è¿™ä¸ªæ¥å£ï¼š

![img](https://mmbiz.qpic.cn/mmbiz_png/vwiav2ugSZtvAQbCCibLiaYVDS4zDwicpfgP8N5DIV1c5IyZT9xC9MIsFPS6ctiaXfCFn3SGe4icf792RyrMykqJS4hQ/640?wx_fmt=jpeg)

ä¸å‡ºæˆ‘ä»¬æ‰€æ–™ï¼Œæœç„¶è¿˜æ˜¯å¯ä»¥çš„~

#### æ–¹æ³•ä¸‰ï¼šé€šè¿‡Filteræ–¹å¼

æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ç°Fiteræ¥å£åœ¨è¯·æ±‚ä¸­æ·»åŠ ä¸€äº›Headeræ¥è§£å†³è·¨åŸŸçš„é—®é¢˜ï¼š

```
@Component
public class CORSFilter implements Filter {

    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
            throws IOException, ServletException {
        HttpServletResponse res = (HttpServletResponse) response;
        res.addHeader("Access-Control-Allow-Credentials", "true");
        res.addHeader("Access-Control-Allow-Origin", "*");
        res.addHeader("Access-Control-Allow-Methods", "GET, POST, DELETE, PUT");
        res.addHeader("Access-Control-Allow-Headers", "Content-Type,X-CAF-Authorization-Token,sessionToken,X-TOKEN");
        if (((HttpServletRequest) request).getMethod().equals("OPTIONS")) {
            response.getWriter().println("ok");
            return;
        }
        chain.doFilter(request, response);
    }
    @Override
    public void destroy() {
    }
    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
    }
}
```

ä¸å‡ºæ„å¤–çš„è¯ï¼Œåº”è¯¥ä¹Ÿå¯ä»¥åœ¨æ§åˆ¶å°è·å–åˆ°è¿”å›ä¿¡æ¯ã€‚

#### æ–¹æ³•å››ï¼šå•ä¸ªæ¥å£æ·»åŠ response header

æ–¹æ³•åŒä¸Š  å®ç°æ–¹å¼çš„ä¸åŒç‚¹åœ¨äº åªåœ¨å•ä¸ªæ¥å£ä¸­çš„responseä¸­æ·»åŠ header ä½¿å¾—å•ä¸ªæ¥å£èƒ½å¤Ÿè·¨åŸŸè®¿é—®


#### Nginxé…ç½®è·¨åŸŸ

å¦‚æœæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­ä½¿ç”¨äº†Nginxï¼Œå¯ä»¥åœ¨Nginxä¸­æ·»åŠ ä»¥ä¸‹çš„é…ç½®æ¥è§£å†³è·¨åŸŸ
ï¼ˆåŸç†å…¶å®å’ŒFilterç±»ä¼¼ï¼Œåªä¸è¿‡æŠŠæ´»å„¿ä¸¢ç»™äº†è¿ç»´ğŸ¤”ï¼‰

```
location / {
   add_header Access-Control-Allow-Origin *;
   add_header Access-Control-Allow-Headers X-Requested-With;
   add_header Access-Control-Allow-Methods GET,POST,PUT,DELETE,OPTIONS;

   if ($request_method = 'OPTIONS') {
     return 204;
   }
}
```